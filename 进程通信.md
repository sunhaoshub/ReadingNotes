# 虚拟地址空间

区分虚拟内存和虚拟地址空间

系统中所有进程的内核区都被映射到同一块物理地址空间

![img](https://subingwen.cn/linux/file-descriptor/image-20210130093015907.png)

* 保留区：空白区，null指针指向的地方
* .text区：只读代码段
* .data区：保存已初始化且不为0的全局变量和静态变量，可读可写
* .bss段：保存未初始化以及初始为0的全局变量和静态变量，操作系统会将这些未初始化变量初始化为0
* 内存映射区：加载磁盘文件，或者加载程序运作过程中需要调用的动态库

# 文件描述符

Linux中万物皆文件

默认分配的文件描述符：

STDIN_FILENO,STDOUT_FILENO,STDERR_FILENO，对应的宏默认是0，1，2

默认分配的文件描述符可以通过close()关掉

# Linux文件IO

系统函数不是内核函数，充当用户和内核函数之间的接口

## open/close

open是Linux系统函数，只对Linux系统适用，fopen是标准c库函数，可以跨平台使用

打开方式对应的宏

```
必须要指定的属性, 以下三个属性不能同时使用, 只能任选其一
O_RDONLY: 以只读方式打开文件
O_WRONLY: 以只写方式打开文件
O_RDWR: 以读写方式打开文件
可选属性, 和上边的属性一起使用
O_APPEND: 新数据追加到文件尾部, 不会覆盖文件的原来内容
O_CREAT: 如果文件不存在, 创建该文件, 如果文件存在什么也不做
O_EXCL: 检测文件是否存在, 必须要和 O_CREAT 一起使用, 不能单独使用: O_CREAT | O_EXCL
检测到文件不存在, 创建新文件
检测到文件已经存在, 创建失败, 函数直接返回-1（如果不添加这个属性，不会返回-1）
```



## read/write

read有一个传出此参数，存储读取的内容

read函数返回值：返回从文件中读取的字节数，为0表示读取完成,<0表示读取失败

## lseek

文件指针函数,返回从文件头部开始计算总的偏移量

```C++
off_t lseek(int fd,off_t offset,int whence);
/*
whence对应的宏：
SEEK_SET:从文件起始处开始偏移offset个字节
SEEK_CUR：从文件当前位置起偏移offset个字节
SEEK_END：从文件结束位置开始偏移offset个字节
*/
```

```C++
//获取文件开始位置
lseek(fd,0,SEEK_SET);
//获取文件当前位置
lseek(fd,0,SEEK_CUR);
//获取文件结束位置
lseek(fd,0,SEEK_END);
```

### 文件拓展

## truncate/ftruncate

截断或扩展

# 文件属性信息

file stat
